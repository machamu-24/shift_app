<h1><%= @shift_month.year %>年 <%= @shift_month.month %>月</h1>
<p>毎日必要な日勤人数：<%= @shift_month.required_day_shifts %></p>
<p>ステータス：<%= @shift_month.status %></p>

<% if @error_message.present? %>
  <hr>
  <h2><%= @error_message %></h2>
  <% if @shortages.any? %>
    <ul>
      <% @shortages.first(5).each do |s| %>
        <li>
          <%= s["date"] %>：必要 <%= s["required"] %> 名 / 可能 <%= s["available"] %> 名（不足 <%= s["shortage"] %> 名）
        </li>
      <% end %>
      <% if @shortages.size > 5 %>
        <li>ほか <%= @shortages.size - 5 %> 日</li>
      <% end %>
    </ul>
  <% end %>
<% end %>

<hr>

<h2>希望休（必須）を追加</h2>

<%= form_with model: [@shift_month, @shift_request], local: true do |f| %>
  <div>
    <%= f.label :staff_id, "スタッフ" %>
    <%= f.collection_select :staff_id, @staffs, :id, :name, prompt: "選択してください" %>
  </div>

  <div>
    <%= f.label :date, "日付" %>
    <%= f.date_field :date %>
  </div>

  <%= f.submit "希望休を追加" %>
<% end %>

<hr>
<h2>登録済み希望休</h2>

<% if @requests.empty? %>
  <p>まだ登録がありません。</p>
<% else %>
  <table border="1" cellpadding="6">
    <thead>
      <tr>
        <th>日付</th>
        <th>スタッフ</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <% @requests.each do |r| %>
        <tr>
          <td><%= r.date %></td>
          <td><%= r.staff.name %></td>
          <td>
            <%= button_to "削除", shift_month_shift_request_path(@shift_month, r),
                  method: :delete,
                  data: { turbo_confirm: "削除しますか？" } %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<hr>

<%= button_to "シフトを自動生成", generate_shift_month_path(@shift_month), method: :post %>

<hr>

<h2>勤務表（カレンダー）</h2>

<% if @matrix.values.all?(&:empty?) %>
  <p>まだ生成されていません。</p>
<% else %>
  <div style="overflow-x: auto;">
    <table border="1" cellpadding="6" style="border-collapse: collapse; white-space: nowrap;">
      <thead>
        <tr>
          <th>名前</th>
          <% @dates.each do |date| %>
            <th>
              <div><%= date.day %></div>
              <div style="font-size: 12px;"><%= %w(日 月 火 水 木 金 土)[date.wday] %></div>
            </th>
          <% end %>
        </tr>
      </thead>

      <tbody>
        <% @staffs.each do |staff| %>
          <tr>
            <th><%= staff.name %></th>
            <% @dates.each do |date| %>
              <% kind = @matrix[staff.id][date] %>
              <td style="text-align: center;">
                <%= kind.present? ? kind : "-" %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>
